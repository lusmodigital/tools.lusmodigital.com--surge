<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Blog Lister HTML</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css"
    />
    <style>
      .form-horizontal {
        display: -webkit-box;
    }
    </style>
  </head>
  <body>
    <div class="my-5" style="margin-left: 20rem; margin-right: 20rem">
      <h1>Blog Lister HTML</h1>
      <form class="form-inline">
        <div class="form-group">
            <input class="form-control mr-3" placeholder="URL Blog List Container" type="text" id="url-template" value="">
        </div>
        <button type="button" class="btn btn-primary" id="getDataBtn">Fetch!</button>
      </form>
        <div class="form-group">
          <label for="html-input">Masukkan Template HTML:</label>
          <textarea
            id="html-input"
            name="html-input"
            class="form-control"
            rows="10"
          ></textarea>
        </div>
        <div class="form-group">
          <label for="html-input">Masukkan Container Blog List:</label>
          <textarea
            id="blog-container"
            name="blog-container"
            class="form-control"
            rows="1"
          ></textarea>
        </div>
        <div class="form-group">
          <label for="html-input">Masukkan Template Blog List:</label>
          <textarea
            id="blog-list"
            name="blog-list"
            class="form-control"
            rows="10"
          ></textarea>
        </div>
      <form class="form mb-2">
        <div class="form-group">
          <label for="html-input">Pilih Opsi Get Article:</label><br>
          <input type="radio" id="html" name="tipe" value="Tunggal">
          <label for="html">Tunggal</label><br>
          <input type="radio" id="css" name="tipe" value="Banyak">
          <label for="css">Banyak</label><br>
        </div>
        <div class="form-group">
          <textarea id="linkGithub" placeholder="Link Github Blog" class="form-control mb-3" rows="1"></textarea>
          <textarea id="urlBlog" placeholder="URL Utama Blog" class="form-control mb-3" rows="1"></textarea>
          <button type="button" class="btn btn-primary" id="getGithub">Fetch!</button>
          <textarea id="banyakURL" placeholder="URL Artikel (Lebih dari 1)" class="form-control mb-3" rows="10"></textarea>
          <input class="form-control mr-3" placeholder="URL Artikel" type="text" id="url-artikel" value="">
        </div>
        <button type="button" class="btn btn-primary" id="getArtikelBtn">Get!</button>
      </form>
      <div id="ContainerSplitGroup" class="row flex-row flex-nowrap">
        <ul class="mr-5 connected-sortable" id="containerDataArticle"
            style="width:320px; height: auto; float: left;">
        </ul>
      </div>
        <div id="meta-title-container">
          <!-- HTML forms -->
          <form id="blogForm">
            <label for="title">Title:</label>
            <input class="form-control mr-3" type="text" id="title" required><br>

            <label for="permalink">Permalink:</label>
            <input class="form-control mr-3" type="text" id="permalink" required><br>

            <label for="imageSrc">Image Source:</label>
            <input class="form-control mr-3" type="text" id="imageSrc" required><br>

            <label for="author">Author:</label>
            <input class="form-control mr-3" type="text" id="author" required><br>

            <label for="author">Author Image Source:</label>
            <input class="form-control mr-3" type="text" id="authorImageSrc" required><br>

            <label for="date">Date:</label>
            <input class="form-control mr-3" type="date" id="date" required><br>

            <label for="category">Category:</label>
            <input class="form-control mr-3" type="text" id="category" required><br>

            <label for="excerpt">Excerpt:</label>
            <textarea class="form-control mr-3" id="excerpt" required></textarea><br>

            <button type="button" class="btn btn-primary" id="addBlog">Add Blog to List!</button>
          </form>

          <!-- Blog List Container -->
          <div id="blogList"></div>
        <div class="d-flex justify-content-end">
          <button
            type="button"
            id="update-html-btn"
            class="btn btn-primary float-end"
            style="display: none"
          >
            Update HTML
          </button>
        </div>
      <div class="alert-container"></div>
      <div id="modalTunggu" class="modal" tabindex="-1" role="dialog">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Mohon Tunggu!</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <p>Sistem sedang memproses fetch dengan bypass policy CORS server URL yang diberikan. Proses ini berlangsung sekitar 30 detik-1 menit.</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Baik</button>
              </div>
            </div>
          </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-html.min.js"></script>
    <script>
      const htmlInput = document.getElementById("html-input");
      var type = 'alwi';
      function extractDomain(url) {
        // Remove "http://" or "https://" from the beginning of the URL
        var hostnameWithPort = url.replace(/^(https?:\/\/)?/, '');
        // Extract the hostname and port
        var match = hostnameWithPort.match(/([^\/:]+)(:\d+)?/);
        if (match) {
          // Return the hostname and port
          return match[0];
        } else {
          // Return an empty string if no match found
          return '';
        }
      }
      function addBlogList(newBlogPost) {
        if (type == 'alwi')
        {
          const htmlText = htmlInput.value;
          const parser = new DOMParser();
          const htmlDocument = parser.parseFromString(htmlText, "text/html");

          const blogListContainer = htmlDocument.querySelector(".tpg-even");
          console.log("dari", blogListContainer)
          // TODO: Add 
          $(blogListContainer).prepend(newBlogPost);
          console.log("jadi", blogListContainer)
          htmlInput.value = htmlDocument.documentElement.outerHTML;
        } else if (type == "anggelin")
        {
          const htmlText = htmlInput.value;
          const parser = new DOMParser();
          const htmlDocument = parser.parseFromString(htmlText, "text/html");

          
          const blogListContainer = htmlDocument.querySelector(".eael-post-grid, .eael-post-appender");
          console.log("dari", blogListContainer)
          // TODO: Add 
          $(blogListContainer).prepend(newBlogPost);
          console.log("jadi", blogListContainer)
          document.getElementById("html-input").value = "<!DOCTYPE html>\n"+htmlDocument.documentElement.outerHTML;
        }
      }

      function detectElementsFromInput() {
        var input = $('#blog-list').val();
        var $parsedInput = $(input);
      
        var elements = {
          title: $parsedInput.find('h1, h2, h3').first().text(),
          permalink: '',
          image: '',
          excerpt: ''
        };
      
        var hrefOccurrences = {};
        var maxHrefOccurrences = 0;
      
        $parsedInput.find('a').each(function() {
          var href = $(this).attr('href');
          if (href) {
            hrefOccurrences[href] = (hrefOccurrences[href] || 0) + 1;
            if (hrefOccurrences[href] > maxHrefOccurrences) {
              elements.permalink = href;
              maxHrefOccurrences = hrefOccurrences[href];
            }
          }
        });
      
        elements.image = $parsedInput.find('img').first().attr('src');
      
        elements.excerpt = $parsedInput.find('meta[name="description"]').attr('content');
      
        return elements;
      }

      function createBlogPost(data) {
        if (type == 'alwi') 
        {        
          const postContainer = document.createElement('div');
          postContainer.setAttribute('class', 'rt-col-md-12 rt-col-sm-12 rt-col-xs-12 img_zoom_out rt-list-item rt-grid-item');
          postContainer.setAttribute('data-id', data.id);
          
          const holder = document.createElement('div');
          holder.setAttribute('class', 'rt-holder tpg-post-holder');
          
          const detail = document.createElement('div');
          detail.setAttribute('class', 'rt-detail rt-el-content-wrapper');
        
          const imageHolder = document.createElement('div');
          imageHolder.setAttribute('class', 'rt-img-holder tpg-el-image-wrap has-thumbnail');
          
          const imageLink = document.createElement('a');
          imageLink.setAttribute('data-id', data.id);
          imageLink.setAttribute('href', data.imageSrc);
          imageLink.setAttribute('class', 'tpg-post-link');
          imageLink.setAttribute('target', '_self');
          
          const image = document.createElement('img');
          image.setAttribute('decoding', 'async');
          image.setAttribute('src', data.imageSrc);
          image.setAttribute('class', 'rt-img-responsive');
          image.setAttribute('width', '391');
          image.setAttribute('height', '261');
          image.setAttribute('alt', data.imageAlt);
          
          const overlay = document.createElement('div');
          overlay.setAttribute('class', 'overlay grid-hover-content');
          
          imageLink.appendChild(image);
          imageHolder.appendChild(imageLink);
          imageHolder.appendChild(overlay);
          
          const postRightContent = document.createElement('div');
          postRightContent.setAttribute('class', 'post-right-content');
        
          const entryTitleWrapper = document.createElement('div');
          entryTitleWrapper.setAttribute('class', 'entry-title-wrapper');
        
          const entryTitle = document.createElement('h4');
          entryTitle.setAttribute('class', 'entry-title');
        
          const postLink = document.createElement('a');
          postLink.setAttribute('data-id', data.id);
          postLink.setAttribute('href', data.postLink);
          postLink.setAttribute('class', 'tpg-post-link');
          postLink.setAttribute('target', '_self');
          postLink.textContent = data.postTitle;
        
          entryTitle.appendChild(postLink);
          entryTitleWrapper.appendChild(entryTitle);
          postRightContent.appendChild(entryTitleWrapper);
        
          const postMetaTags = document.createElement('div');
          postMetaTags.setAttribute('class', 'post-meta-tags rt-el-post-meta');
        
          const authorSpan = document.createElement('span');
          authorSpan.setAttribute('class', 'author has-author-avatar');
        
          const authorImage = document.createElement('img');
          authorImage.setAttribute('alt', '');
          authorImage.setAttribute('src', data.authorImageSrc);
          authorImage.setAttribute('class', 'avatar avatar-80 photo');
          authorImage.setAttribute('height', '80');
          authorImage.setAttribute('width', '80');
        
          const authorLink = document.createElement('a');
          authorLink.setAttribute('href', data.authorLink);
          authorLink.textContent = data.authorName;
        
          authorSpan.appendChild(authorImage);
          authorSpan.appendChild(authorLink);
        
          const dateSpan = document.createElement('span');
          dateSpan.setAttribute('class', 'date');
        
          const calendarIcon = document.createElement('i');
          calendarIcon.setAttribute('aria-hidden', 'true');
          calendarIcon.setAttribute('class', 'far fa-calendar-alt');
        
          const dateLink = document.createElement('a');
          dateLink.setAttribute('href', data.dateLink);
          dateLink.textContent = data.date;
        
          dateSpan.appendChild(calendarIcon);
          dateSpan.appendChild(dateLink);
        
          const categoriesSpan = document.createElement('span');
          categoriesSpan.setAttribute('class', 'categories-links');
        
          const folderIcon = document.createElement('i');
          folderIcon.setAttribute('aria-hidden', 'true');
          folderIcon.setAttribute('class', 'fas fa-folder-open');
        
          const categoryLink = document.createElement('a');
          categoryLink.setAttribute('class', 'tak-berkategori');
          categoryLink.setAttribute('href', 'https://rumahwalet.id/category/tak-berkategori');
          categoryLink.textContent = data.category;
        
          categoriesSpan.appendChild(folderIcon);
          categoriesSpan.appendChild(categoryLink);
        
          postMetaTags.appendChild(authorSpan);
          postMetaTags.appendChild(dateSpan);
          postMetaTags.appendChild(categoriesSpan);

          postRightContent.appendChild(postMetaTags);
        
          const tpgExcerpt = document.createElement('div');
          tpgExcerpt.setAttribute('class', 'tpg-excerpt tpg-el-excerpt');
        
          const tpgExcerptInner = document.createElement('div');
          tpgExcerptInner.setAttribute('class', 'tpg-excerpt-inner');
          tpgExcerptInner.textContent = data.excerpt;
        
          tpgExcerpt.appendChild(tpgExcerptInner);
          postRightContent.appendChild(tpgExcerpt);
        
          const postFooter = document.createElement('div');
          postFooter.setAttribute('class', 'post-footer');
        
          const readMore = document.createElement('div');
          readMore.setAttribute('class', 'read-more');
        
          const readMoreLink = document.createElement('a');
          readMoreLink.setAttribute('data-id', data.id);
          readMoreLink.setAttribute('href', data.readMoreLink);
          readMoreLink.setAttribute('class', 'tpg-post-link');
          readMoreLink.setAttribute('target', '_self');
          readMoreLink.textContent = 'Read More';
        
          readMore.appendChild(readMoreLink);
        
          postFooter.appendChild(readMore);

          postRightContent.appendChild(postFooter);
        
          detail.appendChild(imageHolder);
          detail.appendChild(postRightContent);
        
          holder.appendChild(detail);
          postContainer.appendChild(holder);

          console.log(postContainer);
          addBlogList(postContainer.outerHTML)
          return postContainer;
        } else if (type == 'anggelin')
        {
          const article = document.createElement('article');
          article.setAttribute('class', 'eael-grid-post eael-post-grid-column');
          article.setAttribute('data-id', data.id);

          const postHolder = document.createElement('div');
          postHolder.setAttribute('class', 'eael-grid-post-holder');

          const postHolderInner = document.createElement('div');
          postHolderInner.setAttribute('class', 'eael-grid-post-holder-inner');

          var postHolderInnerContent = `
            <div class="eael-entry-media">
              <div class="eael-entry-overlay fade-in">
                <i class="fas fa-long-arrow-alt-right" aria-hidden="true"></i><a href="${data.postLink}"></a>
              </div>
              <div class="eael-entry-thumbnail">
                <img width="300" height="168" src="${data.imageSrc}" class="attachment-medium size-medium wp-image-1255" alt="" decoding="async" srcset="${data.imageSrc} 300w, ${data.imageSrc} 720w" sizes="(max-width: 300px) 100vw, 300px">
              </div>
            </div>
            <div class="eael-entry-wrapper">
              <header class="eael-entry-header">
                <h2 class="eael-entry-title">
                  <a class="eael-grid-post-link" href="${data.postLink}" title="${data.postTitle}">${data.postTitle}</a>
                </h2>
              </header>
              <div class="eael-entry-content">
                <div class="eael-grid-post-excerpt">
                  <p>${data.excerpt}.</p>
                  <a href="${data.postLink}" class="eael-post-elements-readmore-btn">Read More</a>
                </div>
              </div>
              <div class="eael-entry-header-after style-two">
                <div class="eael-entry-meta">
                  <span class="eael-meta-posted-on"><i class="far fa-clock"></i><time datetime="${data.date}">${data.date}</time></span>
                </div>
              </div>
            </div>
          `;

          // Append the elements
          postHolderInner.innerHTML = postHolderInnerContent;
          postHolder.appendChild(postHolderInner);
          article.appendChild(postHolder);
          addBlogList(article.outerHTML);

          return article;
        }
      }

      function updateValueSingle()
      {
          var title = $('#title').val();
          var permalink = $('#permalink').val();
          var imageSrc = $('#imageSrc').val();
          var authorImageSrc = $('#authorImageSrc').val();
          var author = $('#author').val();
          var category = $('#category').val();
          var excerpt = $('#excerpt').val();
          var date = $('#date').val();
          if (type="anggelin")
          {
            title = title.toUpperCase()
            date = new Date($('#date').val()).toLocaleDateString('en-US', {
              month: 'long',
              day: 'numeric',
              year: 'numeric'
            });
          }
          $('#date').val(date);
          var blogPostData = {
            id: (Math.floor(Math.random() * 10000) + 1).toString(), // Assign a unique ID for the blog post
            postTitle: title,
            postLink: permalink,
            imageSrc: imageSrc,
            authorImageSrc: authorImageSrc,
            authorName: author,
            date: date,
            category: category,
            excerpt: excerpt
          };
          console.log(blogPostData);
    
          var blogPost = createBlogPost(blogPostData);
          $('#blogList').append(blogPost);
      }
      function updateValue(id)
      {
          var title = $('#title-'+id).val();
          var permalink = $('#permalink-'+id).val();
          var imageSrc = $('#imageSrc-'+id).val();
          var authorImageSrc = $('#authorImageSrc-'+id).val();
          var author = $('#author-'+id).val();
          var date = $('#date-'+id).val();
          var category = $('#category-'+id).val();
          var excerpt = $('#excerpt-'+id).val();
          if (type="anggelin")
          {
            title = title.toUpperCase()
            date = new Date($('#date-'+id).val()).toLocaleDateString('en-US', {
              month: 'long',
              day: 'numeric',
              year: 'numeric'
            });
          }
          var blogPostData = {
            id: (Math.floor(Math.random() * 10000) + 1).toString(), // Assign a unique ID for the blog post
            postTitle: title,
            postLink: permalink,
            imageSrc: imageSrc,
            authorImageSrc: authorImageSrc,
            authorName: author,
            date: date,
            category: category,
            excerpt: excerpt
          };
          console.log(blogPostData);
    
          var blogPost = createBlogPost(blogPostData);
          $('#blogList').append(blogPost);
      }
    </script>
    <script>
      // Get the necessary elements
      const urlInput = document.getElementById('url-artikel');
      const banyakURLInput = document.getElementById('banyakURL');
      const github = document.getElementById('linkGithub');
      const urlBlog = document.getElementById('urlBlog');
      const radioButtons = document.querySelectorAll('input[name="tipe"]');

      // Function to enable the URL Artikel input
      function enableUrlInput() {
        urlInput.style.display = "block";
        banyakURLInput.style.display = "none";
        github.style.display = "none";
        urlBlog.style.display = "none";
        document.getElementById("getGithub").style.display = "none";
      }

      // Function to enable the Textarea Convert Split Result
      function enablebanyakURLInput() {
        urlInput.style.display = "none";
        banyakURLInput.style.display = "block";
        github.style.display = "block";
        urlBlog.style.display = "block";
        document.getElementById("getGithub").style.display = "block";
      }

      // Add event listener to radio buttons
      radioButtons.forEach(radioButton => {
        radioButton.addEventListener('change', function() {
          if (this.value === 'Tunggal') {
            enableUrlInput();
          } else if (this.value === 'Banyak') {
            enablebanyakURLInput();
          }
        });
      });

      // Set the initial state based on the default value
      const defaultRadioButton = document.querySelector('input[name="tipe"][value="Tunggal"]');
      defaultRadioButton.checked = true;
      enableUrlInput();

      document.querySelector("#getArtikelBtn").addEventListener('click', checker);
      document.querySelector("#getGithub").addEventListener('click', fetchGithub);

      function fetchGithub()
      {
        var urlGithub = github.value;
        urlGithub = "https://corsproxy.io/?"+encodeURIComponent(urlGithub.replace(".html",""))
        const xhr = new XMLHttpRequest;
        xhr.open("GET", urlGithub);
        xhr.responseType = 'document';
        xhr.onload = () => {
            if (xhr.readyState === xhr.DONE && xhr.status === 200) {
              var XMLResult = xhr.responseXML;
              console.log(XMLResult);
              var serializer = new XMLSerializer();
              var htmlString = serializer.serializeToString(XMLResult);
              const parser = new DOMParser();
              const htmlDocument = parser.parseFromString(htmlString, "text/html");
              // Fetch Blog Links
              const blogLinksInput = document.getElementById("title");
              const blogLinks = htmlDocument.querySelector(
                '.Link--primary'
              );
              if (blogLinks) {
                blogLinksElement.forEach(blogLink => {
                  banyakURLInput.value += blogLink.getAttribute('href') +"\n";
                });
              }
            }
        };
        xhr.send();
      }

      function duplicateElementsBp() {
        var blogListInput = $('#blog-list').val();
        var htmlInput = $($.parseHTML($('#html-input').val()));
      
        var $parsedBlogList = $($.parseHTML(blogListInput));
        var firstElement = $parsedBlogList.first();
      
        var parentContainer = findParentContainer(htmlInput, firstElement);
      
        if (parentContainer.length === 0) {
          console.error('Parent container not found.');
          return;
        }
        var element;
        $parsedBlogList.find('*').each(function() {
          element = $(this).clone();
          console.log("www", element)
          // Modify the element's contents based on the desired logic
          if (element.is('h1, h2, h3, h4, h5, h6')) {
            // Handle the title element
            var title = element.text();
            // Modify the title as needed
            element.text('Modified Title: ' + title);
          } else if (element.is('a')) {
            // Handle the permalink element
            var permalink = element.attr('href');
            // Modify the permalink as needed
            element.attr('href', 'Modified Permalink: ' + permalink);
          } else if (element.is('img')) {
            // Handle the image element
            var imageSrc = element.attr('src');
            // Modify the image source as needed
            element.attr('src', 'Modified Image Source: ' + imageSrc);
          } else if (element.is('p')) {
            // Handle the excerpt element (using <p> tag)
            var excerpt = element.text();
            // Modify the excerpt as needed
            element.text('Modified Excerpt: ' + excerpt);
          }
        });
      
        // Append the modified element to the parent container
        parentContainer.append(element);
      
        // Get the modified HTML content
        var modifiedHtml = $('<div>').append(htmlInput.clone()).html();
        console.log("anjay", modifiedHtml);
        // Update the htmlInput with the modified HTML content
        $('#html-input').val(modifiedHtml);
      }
      
      function duplicateElements() {
        const blogContainer = document.getElementById("blog-container");
        const blogList = document.getElementById("blog-list").value;
        
        var parser = new DOMParser();
        var htmlElement = parser.parseFromString(htmlInput.value, "text/html");
        var containerHtml = parser.parseFromString(blogContainer.value, "text/html").body.firstChild;
        console.log("containerHtml", containerHtml);
        const parentContainerClass = containerHtml.getAttribute("class").split(" ").join(".");
        var containerElement = htmlElement.querySelector("." + parentContainerClass);
        console.log("container", containerElement)
        var blogHtml = parser.parseFromString(blogList, "text/html");
        var clonedBlogHtml = blogHtml.body.firstChild.cloneNode(true);
        console.log("sebelum:")
        console.log(clonedBlogHtml)
        const titleInput = document.getElementById("title");
        const permalinkInput = document.getElementById("permalink");
        const imageInput = document.getElementById("imageSrc");
        console.log(titleInput.value, permalinkInput.value, imageInput.value)
        var modifiedElement = clonedBlogHtml.cloneNode(true); // Create a new modified element
        for (let i = 1; i <= 10; i++) {
          const heading = modifiedElement.querySelector('h' + i + ' a');
          if (heading) {
            heading.textContent = titleInput.value.trim();
            break;
          }
        }
        const allAnchorElements = modifiedElement.querySelectorAll('a');
        allAnchorElements.forEach(anchorElement => {
          anchorElement.setAttribute('href', permalinkInput.value);
        });
        const imgElement = modifiedElement.querySelector("img");
        if (imgElement) {
          imgElement.setAttribute("src", imageInput.value);
        }
        console.log("setelah", modifiedElement)
        $(containerElement).prepend(modifiedElement);
        console.log("container", containerElement)
        htmlInput.value = htmlElement.documentElement.outerHTML;
      }
      

      function duplicateElementsTemp() {
        // Get the input values
        const blogList = document.getElementById("blog-list").value;
        const htmlInput = document.getElementById("html-input").value;
      
        // Create temporary elements to parse the HTML strings
        const tempBlogList = document.createElement("div");
        tempBlogList.innerHTML = blogList.trim();
      
        const tempHtmlInput = document.createElement("div");
        tempHtmlInput.innerHTML = htmlInput.trim();
      
        // Get the first element of the blog list
        const blogListElement = tempBlogList.firstChild;
      
        // Find the parent container in the HTML input
        const parentContainer = findParentContainer(tempHtmlInput, blogListElement);
        console.log("wakwaw", blogListElement)
        if (parentContainer) {
          // Duplicate the blog list element and modify its contents
          const duplicatedElement = blogListElement.cloneNode(true);
          modifyElementContents(duplicatedElement);
      
          // Append the duplicated element to the parent container
          parentContainer.appendChild(duplicatedElement);
      
          // Update the html-input with the modified contents
          document.getElementById("html-input").value = tempHtmlInput.innerHTML;
        }
      }
      
      function findParentContainer(htmlInput, blogListElement) {
        const blogListClass = blogListElement.getAttribute("class");
        const blogListSelector = `.${blogListClass}`;
      
        const candidateContainers = htmlInput.querySelectorAll(blogListSelector);
      
        for (let i = 0; i < candidateContainers.length; i++) {
          const container = candidateContainers[i];
          if (isSameStructure(container, blogListElement)) {
            return container;
          }
        }
      
        return null;
      }
      
      function isSameStructure(element1, element2) {
        if (element1.tagName !== element2.tagName) {
          return false;
        }
      
        const child1Count = element1.childElementCount;
        const child2Count = element2.childElementCount;
      
        if (child1Count !== child2Count) {
          return false;
        }
      
        for (let i = 0; i < child1Count; i++) {
          const child1 = element1.children[i];
          const child2 = element2.children[i];
      
          if (!isSameStructure(child1, child2)) {
            return false;
          }
        }
      
        return true;
      }
      
      function modifyElementContents(element) {
        const titleElement = element.querySelector("h1, h2, h3, h4, h5, h6, h7");
        if (titleElement) {
          titleElement.textContent = "Modified Title";
        }
      
        const permalinkElement = element.querySelector("a");
        if (permalinkElement) {
          permalinkElement.setAttribute("href", "https://example.com");
        }
      
        const imageElement = element.querySelector("img");
        if (imageElement) {
          imageElement.setAttribute("src", "https://example.com/image.jpg");
        }
      
        const excerptElement = element.querySelector("meta[name='description']");
        if (excerptElement) {
          excerptElement.setAttribute("content", "Modified Excerpt");
        }
      }

      function checker() {
        const radioBtn = document.getElementsByName('tipe');
        let selectedValue;
        for (const radioButton of radioBtn) {
          if (radioButton.checked) {
            selectedValue = radioButton.value;
            break;
          }
        }
        if (selectedValue == 'Banyak') 
        {
          let urlBanyak = $("#banyakURL").val();
          let result = '';
          console.log(urlBanyak);
          const splitArray = urlBanyak.split(/\n/g);
          for (let i = 0; i < splitArray.length; i++) {
            result += `<div class="p-2 mt-5" id="containerPerParagraph" style="width:320px; height: auto; background-color:${i % 2 == 0 ? '#bcf4ff' : '#dbdbdb'}">
              <center><h6>Artikel ${i+1}</h6></center><hr>`;
            result += `<div class="form-horizontal" id="form-horizontal-${i}">`;
            result += `<form id="blogForm-${i}">
              <label for="title-${i}">Title:</label>
              <input class="form-control mr-3" type="text" id="title-${i}" required><br>
  
              <label for="permalink-${i}">Permalink:</label>
              <input class="form-control mr-3" type="text" id="permalink-${i}" required><br>
  
              <label for="imageSrc-${i}">Image Source:</label>
              <input class="form-control mr-3" type="text" id="imageSrc-${i}" required><br>
  
              <label for="author-${i}">Author:</label>
              <input class="form-control mr-3" type="text" id="author-${i}" required><br>
  
              <label for="author-${i}">Author Image Source:</label>
              <input class="form-control mr-3" type="text" id="authorImageSrc-${i}" required><br>
  
              <label for="date-${i}">Date:</label>
              <input class="form-control mr-3" type="date" id="date-${i}" required><br>
  
              <label for="category-${i}">Category:</label>
              <input class="form-control mr-3" type="text" id="category-${i}" required><br>
  
              <label for="excerpt-${i}">Excerpt:</label>
              <textarea class="form-control mr-3" id="excerpt-${i}" required></textarea><br>
  
              <button type="button" class="btn btn-primary" id="addBlog-${i}" onclick="updateValue(${i})">Add Blog to List!</button>
            </form>`;
            result += `</div></div>`;
            var url = ""
            if (type == "alwi") url = "https://rumahwalet.id/blog/"+splitArray[i];
            if (type == "anggelin") url = "https://ternakwalet.com/blog-artikel/"+splitArray[i];
            url = "https://corsproxy.io/?"+encodeURIComponent(url.replace(".html",""))
            console.log(i+1, url, splitArray[i], type);
            const xhr = new XMLHttpRequest;
            //let cek = checkAccessControlAllowOrigin(url);
            //if (cek) {
                xhr.open("GET", url);
                xhr.responseType = 'document';
                xhr.onload = () => {
                    if (xhr.readyState === xhr.DONE && xhr.status === 200) {
                        try {
                          var XMLResult = xhr.responseXML;
                          console.log(XMLResult);
                          var serializer = new XMLSerializer();
                          var htmlString = serializer.serializeToString(XMLResult);
                          const parser = new DOMParser();
                          const htmlDocument = parser.parseFromString(htmlString, "text/html");
                          // Fetch Title
                          const entryTitleInput = document.getElementById("title-"+i);
                          const entryTitleElement = htmlDocument.querySelector(
                            '.entry.title'
                          );
                          if (entryTitleElement) {
                            entryTitleInput.value = entryTitleElement.innerText
                              .replace(/\s+/g, " ")
                              .trim();
                            entryTitleElement.innerText = entryTitleInput.value;
                          }
  
                          // Fetch Excerpt
                          const excerptInput = document.getElementById("excerpt-"+i);
                          const excerptElement = htmlDocument.querySelector(
                            'head meta[name="description"]'
                          );
                          if (excerptElement) {
                            excerptInput.value = excerptElement.content
                              .split(' ').slice(0, 10).join(' ')+'...';
                            excerptElement.innerText = excerptInput.value;
                          }
                          console.log('excerpt', excerptElement)
  
                          // Fetch Permalink
                          const permalinkInput = document.getElementById("permalink-"+i);
                          const canonicalElement = htmlDocument.querySelector(
                            'head link[rel="canonical"]'
                          );
                          if (canonicalElement) {
                            permalinkInput.value = canonicalElement.getAttribute("href");
                            canonicalElement.setAttribute("href", permalinkInput.value);
                            const ogUrlElement = htmlDocument.querySelector(
                              'meta[property="og:url"]'
                            );
                            if (ogUrlElement) {
                              ogUrlElement.setAttribute("content", permalinkInput.value);
                            }
                          }
  
                          // Image content detection logic
                          const imagesInput = document.getElementById("imageSrc-"+i);
                          const imagesElement = htmlDocument.querySelector(
                            '.wp-post-image, .size-full, .wp-image'
                          );
                          console.log(imagesElement)
                          if (imagesElement) {
                            const requestedUrl = $("#url-artikel").val()//extractDomain($("#url-artikel").val());
                            const updatedImageUrl = imagesElement.src;//.replace(imagesElement.src, requestedUrl);
                            imagesInput.value = updatedImageUrl;
                            imagesElement.innerHTML = imagesInput.value;
                          }
                        } catch(err) {
                            try {
                              console.log(err)
                                GetDataCORSBypass(url, i, "Banyak")
                            } catch(err) {
                                alert("Error! Pastikan url benar dan konten dalam page berbasis Wordpress Article!")
                            }
                        }
                    }
                };
                xhr.send();
            /*} else {
                GetDataCORSBypass(url, i, "Banyak")
            }*/
          }
          $('#containerDataArticle').append(result);
          console.log(splitArray);
        }
        else if (selectedValue == 'Tunggal')
        {
          let urlArtikel = $("#url-artikel").val();
          // if (type == "alwi") urlArtikel = "https://rumahwalet.id/blog/"+urlArtikel;
          // if (type == "anggelin") urlArtikel = "https://ternakwalet.com/blog-artikel/"+urlArtikel;
          GetArtikel(urlArtikel)
        }
      }

      function GetArtikel(urlArtikel)  {
        urlArtikel = urlArtikel.replace(".html", '')
        const xhr = new XMLHttpRequest;
        let cek = checkAccessControlAllowOrigin(urlArtikel);
        if (cek) {
            xhr.open("GET", urlArtikel);
            xhr.responseType = 'document';
            xhr.onload = () => {
                if (xhr.readyState === xhr.DONE && xhr.status === 200) {
                  var XMLResult = xhr.responseXML;
                  console.log(XMLResult);
                  var serializer = new XMLSerializer();
                  var htmlString = serializer.serializeToString(XMLResult);
                  const parser = new DOMParser();
                  const htmlDocument = parser.parseFromString(htmlString, "text/html");
                  // Fetch Title
                  const entryTitleInput = document.getElementById("title");
                  const entryTitleElement = htmlDocument.querySelector(
                    '.entry-title'
                  );
                  if (entryTitleElement) {
                    entryTitleInput.value = entryTitleElement.innerText
                      .replace(/\s+/g, " ")
                      .trim();
                    entryTitleElement.innerText = entryTitleInput.value;
                  }

                  // Fetch Excerpt
                  const excerptInput = document.getElementById("excerpt");
                  const excerptElement = htmlDocument.querySelector(
                    'head meta[name="description"]'
                  );
                  if (excerptElement) {
                    excerptInput.value = excerptElement.content
                      .split(' ').slice(0, 10).join(' ')+'...';
                    excerptElement.innerText = excerptInput.value;
                  }
                  console.log('excerpt', excerptElement)

                  // Fetch Permalink
                  const permalinkInput = document.getElementById("permalink");
                  const canonicalElement = htmlDocument.querySelector(
                    'head link[rel="canonical"]'
                  );
                  if (canonicalElement) {
                    permalinkInput.value = canonicalElement.getAttribute("href");
                    canonicalElement.setAttribute("href", permalinkInput.value);
                    const ogUrlElement = htmlDocument.querySelector(
                      'meta[property="og:url"]'
                    );
                    if (ogUrlElement) {
                      ogUrlElement.setAttribute("content", permalinkInput.value);
                    }
                  }

                  // Image content detection logic
                  const imagesInput = document.getElementById("imageSrc");
                  const imagesElement = htmlDocument.querySelector(
                    '.wp-post-image, .size-full, .wp-image'
                  );
                  console.log(imagesElement)
                  if (imagesElement) {
                    const requestedUrl = $("#url-artikel").val()//extractDomain($("#url-artikel").val());
                    const updatedImageUrl = imagesElement.src;//.replace(imagesElement.src, requestedUrl);
                    imagesInput.value = updatedImageUrl;
                    imagesElement.innerHTML = imagesInput.value;
                  }
                  duplicateElements()
                }
            };
            xhr.send();
        } else {
            GetDataCORSBypass(urlArtikel, 0, "Tunggal")
        }
      }

      function showDataSplit() {
        paragraphs_object.forEach((paragraph, paragraph_index) => {
            let result = '';
            result += `<div class="p-2 mt-5" id="containerPerParagraph" style="width:320px; height: auto; background-color:${paragraph_index % 2 == 0 ? '#bcf4ff' : '#dbdbdb'}">
            <center><h6>Paragraph ${paragraph_index+1}</h6></center><hr>`;
    
            paragraph.sentences.forEach((sentence, sentence_index) => {
                let withDot = (paragraph.length_of_sentences-1) > sentence_index ? '' : '';
    
                result += `<div class="form-horizontal" id="form-horizontal-${paragraph_index}-${sentence_index}">`;
                result += `<div class="mt-2 p-2 sentence-item" style="background-color:#dbdbdb">
                        <a>Kalimat ${sentence_index+1}</a>
                        <textarea class="form-control" name="paragraph[]" rows="3">${sentence}${withDot}</textarea>
                        <center>
                        <button class="btn btn-sm btn-info" onclick="AddOpenAIText('${paragraph_index}','${sentence_index}')">Add</button>
                        <button class="btn btn-sm btn-danger" onclick="DeleteHorizontalSentence('${paragraph_index}','${sentence_index}')">Delete</button>
                        </center>
                    </div> `;
                result += `</div>`;
                if (paragraph_index == paragraphs_object.length-1)
                {
                    result += `<div class="p-2 mt-5" id="containerPerParagraph" style="width:320px; height: auto; background-color:${paragraph_index+1 % 2 == 0 ? '#bcf4ff' : '#dbdbdb'}">
                    <center><h6>Output</h6></center><hr>`;
                    result += `<div class="form-horizontal" id="form-horizontal-${paragraph_index}-${sentence_index}-output">`;
                    result += `<div class="mt-2 p-2 sentence-item" style="background-color:#dbdbdb">
                        <center>
                        <b class="mb-2">Hasil Artikel ke-0</b>
                        </div>`;
                    result += `</div>`;
                    result += `</div>`;
                }
            });
            result += `</div>`;
    
            $('#containerDataArticle').append(result);
        });
    }
    </script>
    <script>
      document.querySelector("#getDataBtn").addEventListener('click', GetData);
      $(document).ready(function() {
        $('#canonical-url').on('input', function() {
          var permalink = $(this).val();
      
          // Replace multiple spaces with a single space
          permalink = permalink.replace(/\s+/g, ' ');
      
          // Convert to lowercase
          permalink = permalink.toLowerCase();
      
          // Replace non-alphanumeric characters with spaces
          permalink = permalink.replace(/\W/g, ' ');
          
          // Replace spaces with dashes
          permalink = permalink.replace(/\s+/g, '-');
      
          // Update the value of the input field
          $(this).val(permalink);
        });
      });

      function checkBlogListFormat() {

      }

      function GetDataCORSBypass(urlArtikel, id, tipe) {
        try {
            $.getJSON('https://corsproxy.io/?'+encodeURIComponent(urlArtikel), function (data) {
                const parser = new DOMParser();
                console.log("CEKK", urlArtikel, extractDomain(urlArtikel))
                const htmlDocument = parser.parseFromString(data.contents, 'text/html');
                if (tipe == "Banyak") {
                  // Fetch Title
                  const entryTitleInput = document.getElementById("title-"+id);
                  const entryTitleElement = htmlDocument.querySelector(
                    '.entry-title'
                  );
                  if (entryTitleElement) {
                    entryTitleInput.value = entryTitleElement.innerText
                      .replace(/\s+/g, " ")
                      .trim();
                    entryTitleElement.innerText = entryTitleInput.value;
                  }

                  // Fetch Excerpt
                  const excerptInput = document.getElementById("excerpt-"+id);
                  const excerptElement = htmlDocument.querySelector(
                    'head meta[name="description"]'
                  );
                  if (excerptElement) {
                    excerptInput.value = excerptElement.content
                      .split(' ').slice(0, 10).join(' ')+'...';
                    excerptElement.innerText = excerptInput.value;
                  }
                  console.log('excerpt', excerptElement)

                  // Fetch Permalink
                  const permalinkInput = document.getElementById("permalink-"+id);
                  const canonicalElement = htmlDocument.querySelector(
                    'head link[rel="canonical"]'
                  );
                  if (canonicalElement) {
                    permalinkInput.value = canonicalElement.getAttribute("href");
                    canonicalElement.setAttribute("href", permalinkInput.value);
                    const ogUrlElement = htmlDocument.querySelector(
                      'meta[property="og:url"]'
                    );
                    if (ogUrlElement) {
                      ogUrlElement.setAttribute("content", permalinkInput.value);
                    }
                  }

                  // Image content detection logic
                  const imagesInput = document.getElementById("imageSrc-"+id);
                  const imagesElement = htmlDocument.querySelector(
                    '.wp-post-image, .size-full, .wp-image'
                  );
                  console.log(imagesElement)
                  if (imagesElement) {
                    const requestedUrl = $("#url-artikel").val()//extractDomain($("#url-artikel").val());
                    const updatedImageUrl = imagesElement.src;//.replace(imagesElement.src, requestedUrl);
                    imagesInput.value = updatedImageUrl;
                    imagesElement.innerHTML = imagesInput.value;
                  }
                }
                else
                {
                  // Fetch Title
                  const entryTitleInput = document.getElementById("title");
                  const entryTitleElement = htmlDocument.querySelector(
                    '.entry-title'
                  );
                  if (entryTitleElement) {
                    entryTitleInput.value = entryTitleElement.innerText
                      .replace(/\s+/g, " ")
                      .trim();
                    entryTitleElement.innerText = entryTitleInput.value;
                  }

                  // Fetch Excerpt
                  const excerptInput = document.getElementById("excerpt");
                  const excerptElement = htmlDocument.querySelector(
                    'head meta[name="description"]'
                  );
                  if (excerptElement) {
                    excerptInput.value = excerptElement.content
                      .split(' ').slice(0, 10).join(' ')+'...';
                    excerptElement.innerText = excerptInput.value;
                  }
                  console.log('excerpt', excerptElement)

                  // Fetch Permalink
                  const permalinkInput = document.getElementById("permalink");
                  const canonicalElement = htmlDocument.querySelector(
                    'head link[rel="canonical"]'
                  );
                  if (canonicalElement) {
                    permalinkInput.value = canonicalElement.getAttribute("href");
                    canonicalElement.setAttribute("href", permalinkInput.value);
                    const ogUrlElement = htmlDocument.querySelector(
                      'meta[property="og:url"]'
                    );
                    if (ogUrlElement) {
                      ogUrlElement.setAttribute("content", permalinkInput.value);
                    }
                  }

                  // Image content detection logic
                  const imagesInput = document.getElementById("imageSrc");
                  const imagesElement = htmlDocument.querySelector(
                    '.wp-post-image, .size-full, .wp-image'
                  );
                  console.log(imagesElement)
                  if (imagesElement) {
                    const requestedUrl = $("#url-artikel").val()//extractDomain($("#url-artikel").val());
                    const updatedImageUrl = imagesElement.src;//.replace(imagesElement.src, requestedUrl);
                    imagesInput.value = updatedImageUrl;
                    imagesElement.innerHTML = imagesInput.value;
                  }
                }
            });
            $('#modalTunggu').modal('show');
            console.log("Sedang memproses fetch dengan bypass policy CORS server URL yang diberikan. Proses ini berlangsung sekitar 30 detik - 1 menit.")
        } catch(err) {
            console.log(err);
            alert("Error! Pastikan url benar dan konten dalam page berbasis Wordpress Article!")
        }
      }
      
      function checkAccessControlAllowOrigin(url) {
        var xhr = new XMLHttpRequest();
        xhr.open('HEAD', url, false);
        try {
          xhr.send();
        } catch (e) {
          console.log('AccessControlAllowOrigin tidak diizinkan!');
        }
        let check = false;
        try {
          if (xhr.getAllResponseHeaders() != '') check = true;
          if (xhr.getAllResponseHeaders().indexOf("Access-Control-Allow-Origin") >= 0)
              check = true;
          console.log("check")
          console.log('"'+xhr.getAllResponseHeaders()+'"')
        } catch (e) {console.log(e)}
        console.log(check)
        return check;
      }
      $(document).ready(function() {
        // Handle "Add Blog" form submission
        document.querySelector("#addBlog").addEventListener('click', updateValueSingle);
      });
      function GetData()  {
        const xhr = new XMLHttpRequest;
        let urlBlogList = $("#url-template").val()
        let urlDomain = extractDomain(urlBlogList);
        if (urlDomain == 'rumahwalet.id') type = 'alwi';
        else  if (urlDomain == 'ternakwalet.com') 
        {
          type = 'anggelin';
          $('#author, #authorImageSrc, #category').prop('disabled', true);
        }
        urlBlogList = "https://corsproxy.io/?"+encodeURIComponent(urlBlogList.replace(".html", ""))
        let cek = checkAccessControlAllowOrigin(urlBlogList);
        if (cek) {
            xhr.open("GET", urlBlogList);
            xhr.responseType = 'document';
            xhr.onload = () => {
                if (xhr.readyState === xhr.DONE && xhr.status === 200) {
                    try {
                        var XMLResult = xhr.responseXML;
                        console.log(XMLResult);
                        var serializer = new XMLSerializer();
                        var htmlString = serializer.serializeToString(XMLResult);
                        $('#html-input').val(htmlString);
                    } catch(err) {
                        try {
                          console.log("error:", err)
                            GetDataCORSBypass(urlBlogList, 0, "Tunggal")
                        } catch(err) {
                            alert("Error! Pastikan url benar dan konten dalam page berbasis Wordpress Article!")
                        }
                    }
                }
            };
    
            xhr.send();
        } else {
            GetDataCORSBypass(urlBlogList, 0, "Tunggal")
        }
      }
    </script>
  </body>
</html>
